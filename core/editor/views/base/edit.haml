- body_class 'form'
- title "Edit: %s" % [ item.to_s ]

- content_for :nav do
  - if item.children.any?
    %nav.back
      - if item.parent.nil?
        %a{:href => R(:admin)} Dashboard
      - else
        != link_to item.parent.path(:edit), item.parent.to_s
    %nav.crumbs
      != link_to item.path(:edit), item.to_s

    %nav
      -#%h3 Pages
      %ul
        - (item.try(:nearest) || []).each do |subitem|
          %li
            != link_to subitem.path(:edit), subitem.to_s
            - if subitem.path(:new) == request.fullpath
              %ul
                %li.add
                  != link_to subitem.path(:new), "New item"
        %li.add
          != link_to item.path(:new), "New item"

  - else
    - if item.parent.nil?
      != yield_content_of 'admin/dashboard', :nav

    - else
      != yield_content_of item.templates_for(:edit), :nav, { :item => item.parent }

- content_for :title do
  %h1
    Editing
    = item

- content_for :toolbar do
  %li
    %a{href: item.path} View
  %li
    %a{href: item.path(:delete)} Delete
  %li
    %a{href: item.path(:new)} Create new

- content_for :body do
  - if item.errors.any?
    .flash.validation-errors
      %h3 Can't continue:
      %ul
        - item.errors.each do |field, errs|
          - errs.each do |err|
            %li
              = field
              = err

  %form{:action => action, :method => 'post' }
    != partial item.templates_for(:form), :item => item
    %p.submit
      %button{:type => 'submit'}
        %span Save
